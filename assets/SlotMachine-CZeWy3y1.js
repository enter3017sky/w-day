import{S as e,_ as t,a as n,f as r,g as i,i as a,m as o,n as s,o as c,r as l,t as u,x as d,y as f}from"./index-CVPqryWZ.js";var p=[`src`,`height`],m={__name:`Gift`,props:{trigger:{type:Date,default:void 0},config:{type:Object,required:!0}},emits:[`finished`],setup(n,{emit:u}){let m=n,h=u,g=f(null),_=f(!1),v=f(0),y=f(0),b=f([]),x=l(()=>m.config.run3D?`three-dimension`:`flat`),S=l(()=>360/m.config.gifts.length),C=l(()=>m.config.height/2/Math.tan(S.value/2/180*Math.PI)),w=()=>{g.value&&(g.value.style.setProperty(`--rotateY`,`${m.config.rotateY}deg`),g.value.style.setProperty(`--duration`,`${m.config.duration}ms`),g.value.style.setProperty(`--fontSize`,`${m.config.fontSize}px`),g.value.style.setProperty(`--height`,`${m.config.height}px`),g.value.style.setProperty(`--width`,`${m.config.width}px`),g.value.style.setProperty(`--currentDeg`,`-${v.value}deg`))},T=()=>{m.config.gifts.forEach((e,t)=>{b.value[t]={from:t===0?0:b.value[t-1].to,to:t===0?S.value:b.value[t-1].to+S.value,name:e.name}})},E=()=>{if(!g.value)return;let e=Math.random()*360+360*5;e-=e%S.value,y.value=e;let t=m.config.rollback?Math.random()*m.config.rollback+1:1;g.value.style.setProperty(`--targetDeg`,`-${y.value}deg`),g.value.style.setProperty(`--rollBackDeg`,`${t}`),_.value=!0},D=()=>{if(!g.value)return;v.value=y.value%360,g.value.style.setProperty(`--currentDeg`,`-${v.value}deg`);let e=v.value+S.value/2,t=null;b.value.forEach(n=>{e>=n.from&&e<=n.to&&(t=n.name)}),_.value=!1,h(`finished`,t)},O=e=>{let t=`./../assets/slotImg/img_${e}.jpg`;return new URL(t,import.meta.url).href};return t(()=>m.config,()=>{w()},{deep:!0}),t(()=>m.trigger,()=>{E()}),t(_,e=>{e&&setTimeout(()=>{D()},m.config.duration+200)}),r(()=>{w(),T()}),(t,r)=>(o(),c(`div`,{ref_key:`container`,ref:g,class:d([`gift-container`,x.value,{autoTurn:_.value}])},[(o(!0),c(s,null,i(n.config.gifts,(t,r)=>(o(),c(`div`,{key:r,class:d([`gift`,n.config.style]),style:e(`transform: rotateX(${S.value*r}deg) translateZ(${C.value}px)`)},[a(`img`,{src:O(r),height:n.config.height},null,8,p)],6))),128))],2))}},h=u(m,[[`__scopeId`,`data-v-aeb8529b`]]),g={id:`SlotMachine`},_={class:`body`},v={class:`window`},y={class:`slot__container`},b={__name:`index`,setup(e){f(!1);let t=f(null),l=f(!1),u=f(!1);f(!1);let p=f([]),m=f([]),b=f([{style:`gift-style`,gifts:Array.from({length:15},(e,t)=>({type:`text`,name:t})),duration:4e3,fontSize:150,height:500,width:900}]),x=()=>{l.value=!0,setTimeout(()=>{l.value=!1},500),u.value=!0,t.value=new Date},S=e=>{let t=document.querySelectorAll(`.autoTurn`);m.value.push(e),t.length===1&&(u.value=!1,p.value.push(m.value),m.value=[])};return r(()=>{}),(e,r)=>(o(),c(`div`,g,[r[3]||=a(`div`,{class:`badge`},[a(`span`,null,`SlotMachine`)],-1),a(`div`,_,[a(`div`,v,[a(`div`,y,[(o(!0),c(s,null,i(b.value,(e,r)=>(o(),n(h,{key:r,trigger:t.value,config:e,onFinished:S},null,8,[`trigger`,`config`]))),128))])]),a(`div`,{class:d([`handler`,{active:l.value,disabled:u.value}])},[r[1]||=a(`div`,{class:`stick2`},null,-1),r[2]||=a(`div`,{class:`stick`},null,-1),a(`div`,{class:`ball`,onClick:r[0]||=e=>!u.value&&x()})],2)])]))}};export{b as default};