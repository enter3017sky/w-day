import{C as e,S as t,_ as n,a as r,b as i,h as a,i as o,n as s,o as c,p as l,r as u,t as d,v as f}from"./index-HlAspBsB.js";var p=[`src`,`height`],m={__name:`Gift`,props:{trigger:{type:Date,default:void 0},config:{type:Object,required:!0}},emits:[`finished`],setup(r,{emit:d}){let m=r,h=d,g=i(null),_=i(!1),v=i(0),y=i(0),b=i([]),x=u(()=>m.config.run3D?`three-dimension`:`flat`),S=u(()=>360/m.config.gifts.length),C=u(()=>m.config.height/2/Math.tan(S.value/2/180*Math.PI)),w=()=>{g.value&&(g.value.style.setProperty(`--rotateY`,`${m.config.rotateY}deg`),g.value.style.setProperty(`--duration`,`${m.config.duration}ms`),g.value.style.setProperty(`--fontSize`,`${m.config.fontSize}px`),g.value.style.setProperty(`--height`,`${m.config.height}px`),g.value.style.setProperty(`--width`,`${m.config.width}px`),g.value.style.setProperty(`--currentDeg`,`-${v.value}deg`))},T=()=>{m.config.gifts.forEach((e,t)=>{b.value[t]={from:t===0?0:b.value[t-1].to,to:t===0?S.value:b.value[t-1].to+S.value,name:e.name}})},E=()=>{if(!g.value)return;let e=Math.random()*360+360*5;e-=e%S.value,y.value=e;let t=m.config.rollback?Math.random()*m.config.rollback+1:1;g.value.style.setProperty(`--targetDeg`,`-${y.value}deg`),g.value.style.setProperty(`--rollBackDeg`,`${t}`),_.value=!0},D=()=>{if(!g.value)return;v.value=y.value%360,g.value.style.setProperty(`--currentDeg`,`-${v.value}deg`);let e=v.value+S.value/2,t=null;b.value.forEach(n=>{e>=n.from&&e<=n.to&&(t=n.name)}),_.value=!1,h(`finished`,t)},O=e=>{let t=`./../assets/slotImg/img_${e}.jpg`;return new URL(t,import.meta.url).href};return f(()=>m.config,()=>{w()},{deep:!0}),f(()=>m.trigger,()=>{E()}),f(_,e=>{e&&setTimeout(()=>{D()},m.config.duration+200)}),l(()=>{w(),T()}),(i,l)=>(a(),c(`div`,{ref_key:`container`,ref:g,class:t([`gift-container`,x.value,{autoTurn:_.value}])},[(a(!0),c(s,null,n(r.config.gifts,(n,i)=>(a(),c(`div`,{key:i,class:t([`gift`,r.config.style]),style:e(`transform: rotateX(${S.value*i}deg) translateZ(${C.value}px)`)},[o(`img`,{src:O(i),height:r.config.height},null,8,p)],6))),128))],2))}},h=d(m,[[`__scopeId`,`data-v-aeb8529b`]]),g={id:`SlotMachine`},_={class:`body`},v={class:`window`},y={class:`slot__container`},b={__name:`index`,setup(e){i(!1);let u=i(null),d=i(!1),f=i(!1);i(!1);let p=i([]),m=i([]),b=i([{style:`gift-style`,gifts:Array.from({length:15},(e,t)=>({type:`text`,name:t})),duration:4e3,fontSize:150,height:500,width:900}]),x=()=>{d.value=!0,setTimeout(()=>{d.value=!1},500),f.value=!0,u.value=new Date},S=e=>{let t=document.querySelectorAll(`.autoTurn`);m.value.push(e),t.length===1&&(f.value=!1,p.value.push(m.value),m.value=[])};return l(()=>{}),(e,i)=>(a(),c(`div`,g,[i[3]||=o(`div`,{class:`badge`},[o(`span`,null,`SlotMachine`)],-1),o(`div`,_,[o(`div`,v,[o(`div`,y,[(a(!0),c(s,null,n(b.value,(e,t)=>(a(),r(h,{key:t,trigger:u.value,config:e,onFinished:S},null,8,[`trigger`,`config`]))),128))])]),o(`div`,{class:t([`handler`,{active:d.value,disabled:f.value}])},[i[1]||=o(`div`,{class:`stick2`},null,-1),i[2]||=o(`div`,{class:`stick`},null,-1),o(`div`,{class:`ball`,onClick:i[0]||=e=>!f.value&&x()})],2)])]))}};export{b as default};